<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Battle: Dungeons of Knowledge - Endless Mode</title>
    <link href="https://fonts.googleapis.com/css2?family=MedievalSharp&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/style.css">
    <style>
        body { font-family: 'Times New Roman', Times, serif; background: #2e3d1f; color: #f3eac2; }
        .container { max-width: 600px; margin: 40px auto; background: #f3eac2; border: 6px solid #4b2e05; border-radius: 24px; box-shadow: 0 0 24px #0008; padding: 32px 24px 24px 24px; text-align: center; }
        .timer { font-size: 1.3em; color: #b22222; margin-bottom: 12px; }
        .hp { color: #228B22; font-weight: bold; }
        .streak { color: #e6c15b; font-weight: bold; }
        .score { color: #2e3d1f; font-weight: bold; }
        .btn { font-family: 'Times New Roman', Times, serif; }
        
        /* Question Type Styles */
        .answer-options { margin: 20px 0; }
        .option-button { background: #fffbe6; border: 3px solid #4b2e05; border-radius: 12px; padding: 15px 20px; margin: 10px 0; cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; gap: 15px; }
        .option-button:hover { background: #ffeebc; transform: scale(1.02); }
        .option-button.selected { background: #4b2e05; color: #f3eac2; }
        .option-letter { font-weight: bold; font-size: 1.2em; min-width: 30px; }
        .option-text { flex: 1; }
        .tf-buttons { display: flex; gap: 20px; justify-content: center; margin: 20px 0; }
        .tf-button { background: #fffbe6; border: 3px solid #4b2e05; border-radius: 12px; padding: 20px 30px; cursor: pointer; transition: all 0.2s ease; display: flex; flex-direction: column; align-items: center; gap: 10px; min-width: 120px; }
        .tf-button:hover { background: #ffeebc; transform: scale(1.05); }
        .tf-button.selected { background: #4b2e05; color: #f3eac2; }
        .tf-icon { font-size: 2em; font-weight: bold; }
        .tf-text { font-size: 1.1em; font-weight: bold; }
        .selected-answer { background: #e8f5e8; border: 2px solid #4caf50; border-radius: 8px; padding: 10px; margin: 15px 0; color: #2e7d32; font-weight: bold; text-align: center; }
        .short-answer-input { width: 100%; max-width: 500px; }
        .btn:disabled { background: #ccc; cursor: not-allowed; transform: none; }
        .btn:disabled:hover { background: #ccc; transform: none; }
    </style>
</head>
<body>
    <div class="container">
    <h1 class="endless-title">üêâ Endless Mode</h1>
    
    <!-- Quit Button -->
    <div style="text-align: right; margin-bottom: 10px;">
        <button onclick="quitEndlessMode()" class="btn" style="background: #cc4400; font-size: 0.9em; padding: 8px 15px;">üö™ Quit</button>
    </div>
    
    <div class="timer" id="timer" data-time-left="{{ time_left }}">Time Left: {{ time_left }} sec</div>
    <div class="questions-left">Questions Answered: {{ q_number - 1 }}</div>
    <div class="hp">Player: {{ session.get('player_name', 'Unknown') }} &nbsp;|&nbsp; HP: {{ player_hp }}</div>
    <div class="streak">Streak: {{ streak }}/5</div>
    <div class="score">Score: {{ score }}</div>
    <div class="question" style="margin-top:32px;">{{ question['q'] }}</div>
    <form method="POST" style="margin-top:24px;" id="endlessAnswerForm">
        {% set question_type = question.get('type', 'short_answer') %}
        
        {% if question_type == 'multiple_choice' %}
            <!-- Multiple Choice Options -->
            <div class="answer-options">
                {% for i in range(question.options|length) %}
                {% set option_letter = ['A', 'B', 'C', 'D'][i] %}
                <div class="option-button" onclick="selectEndlessOption('{{ option_letter|lower }}', '{{ question.options[i] }}')">
                    <span class="option-letter">{{ option_letter }})</span>
                    <span class="option-text">{{ question.options[i] }}</span>
                </div>
                {% endfor %}
            </div>
            <input type="hidden" name="answer" id="endlessSelectedAnswer" required>
            <div class="selected-answer" id="endlessSelectedDisplay" style="display: none;">
                Selected: <span id="endlessSelectedText"></span>
            </div>
            <button type="submit" class="btn" id="endlessSubmitButton" disabled>Submit</button>
            
        {% elif question_type == 'true_false' %}
            <!-- True/False Buttons -->
            <div class="tf-buttons">
                <div class="tf-button" onclick="selectEndlessTrueFalse('True')">
                    <span class="tf-icon">‚úì</span>
                    <span class="tf-text">True</span>
                </div>
                <div class="tf-button" onclick="selectEndlessTrueFalse('False')">
                    <span class="tf-icon">‚úó</span>
                    <span class="tf-text">False</span>
                </div>
            </div>
            <input type="hidden" name="answer" id="endlessTfAnswer" required>
            <div class="selected-answer" id="endlessTfSelectedDisplay" style="display: none;">
                Selected: <span id="endlessTfSelectedText"></span>
            </div>
            <button type="submit" class="btn" id="endlessTfSubmitButton" disabled>Submit</button>
            
        {% else %}
            <!-- Short Answer Input -->
            <input type="text" name="answer" placeholder="Type your answer..." required style="font-size:1.2em; padding:8px 12px; border-radius:8px; border:2px solid #4b2e05;" class="short-answer-input">
            <button type="submit" class="btn" style="margin-left:12px;">Submit</button>
        {% endif %}
    </form>
    </div>
<script type="text/javascript">
    // Live countdown timer (in seconds)
    var timerElement = document.getElementById('timer');
    var timeLeft = parseInt(timerElement.getAttribute('data-time-left'));
    function updateTimer() {
        if (timeLeft < 0) timeLeft = 0;
        timerElement.textContent = `Time Left: ${timeLeft} sec`;
        if (timeLeft > 0) {
            timeLeft--;
            setTimeout(updateTimer, 1000);
        } else {
            // Auto-submit form if timer runs out
            document.querySelector('form').submit();
        }
    }
    updateTimer();
    
    // Quit endless mode function with confirmation
    function quitEndlessMode() {
        const questionsAnswered = {{ q_number - 1 }};
        const currentScore = {{ score }};
        const currentStreak = {{ streak }};
        const playerHP = {{ player_hp }};
        
        const confirmMessage = `‚ö†Ô∏è Are you sure you want to quit Endless Mode?\n\n` +
                             `You will lose your current progress:\n` +
                             `‚Ä¢ Questions answered: ${questionsAnswered}\n` +
                             `‚Ä¢ Score: ${currentScore}\n` +
                             `‚Ä¢ Streak: ${currentStreak}/5\n` +
                             `‚Ä¢ HP: ${playerHP}\n\n` +
                             `Click OK to quit or Cancel to continue playing.`;
        
        if (confirm(confirmMessage)) {
            window.location.href = '/quit_endless';
        }
    }
    
    // Question type interaction functions for endless mode
    function selectEndlessOption(letter, optionText) {
        // Clear previous selections
        document.querySelectorAll('.option-button').forEach(btn => {
            btn.classList.remove('selected');
        });
        
        // Select current option
        event.target.closest('.option-button').classList.add('selected');
        
        // Set the answer values
        document.getElementById('endlessSelectedAnswer').value = optionText;
        document.getElementById('endlessSelectedDisplay').style.display = 'block';
        document.getElementById('endlessSelectedText').textContent = letter.toUpperCase() + ') ' + optionText;
        
        // Enable submit button
        document.getElementById('endlessSubmitButton').disabled = false;
    }
    
    function selectEndlessTrueFalse(answer) {
        // Clear previous selections
        document.querySelectorAll('.tf-button').forEach(btn => {
            btn.classList.remove('selected');
        });
        
        // Select current option
        event.target.closest('.tf-button').classList.add('selected');
        
        // Set the answer values
        document.getElementById('endlessTfAnswer').value = answer;
        document.getElementById('endlessTfSelectedDisplay').style.display = 'block';
        document.getElementById('endlessTfSelectedText').textContent = answer;
        
        // Enable submit button
        document.getElementById('endlessTfSubmitButton').disabled = false;
    }
</script>
</body>
</html>
