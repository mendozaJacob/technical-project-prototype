<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Battle: Dungeons of Knowledge - Student Progress</title>
    <style>
        body { 
            font-family: 'Times New Roman', Times, serif; 
            background: #2e3d1f; 
            color: #333; 
            margin: 0;
            padding: 20px;
        }
        .container { 
            max-width: 1200px; 
            margin: 20px auto; 
            background: #f3eac2; 
            border: 6px solid #4b2e05; 
            border-radius: 24px; 
            box-shadow: 0 0 24px #0008; 
            padding: 40px; 
        }
        .page-title {
            color: #4b2e05; 
            font-size: 2.5em; 
            margin-bottom: 10px;
            text-align: center;
        }
        .student-info {
            background: #fffbe6;
            border: 3px solid #4b2e05;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            color: #4b2e05;
        }
        .header-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        .btn {
            font-family: 'Times New Roman', Times, serif;
            background: #4b2e05;
            color: #f3eac2;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            text-decoration: none;
            display: inline-block;
            margin: 5px;
        }
        .btn:hover {
            background: #6d4106;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        .stat-card {
            background: #fffbe6;
            border: 3px solid #4b2e05;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            color: #4b2e05;
        }
        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #2d5016;
            margin-bottom: 10px;
        }
        .stat-label {
            font-size: 1.1em;
            color: #4b2e05;
        }
        .levels-completed {
            background: #fffbe6;
            border: 3px solid #4b2e05;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            color: #4b2e05;
        }
        .level-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        .level-badge {
            background: #2d5016;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
        }
        .game-history {
            background: #fffbe6;
            border: 3px solid #4b2e05;
            border-radius: 12px;
            padding: 20px;
            color: #4b2e05;
        }
        .history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        .history-table th,
        .history-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        .history-table th {
            background: #f0f0f0;
            font-weight: bold;
        }
        .history-table tr:hover {
            background: #f9f9f9;
        }
        .accuracy-good { color: #2d5016; font-weight: bold; }
        .accuracy-fair { color: #b8860b; font-weight: bold; }
        .accuracy-poor { color: #8b1e3f; font-weight: bold; }
        .flash-messages {
            margin-bottom: 20px;
        }
        .flash-message {
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 10px;
        }
        .flash-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .flash-error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .flash-info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-controls">
            <h1 class="page-title">üìä Student Progress Report</h1>
            <a href="{{ url_for('teacher_students') }}" class="btn">‚Üê Back to Students</a>
        </div>

        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages">
                    {% for category, message in messages %}
                        <div class="flash-message flash-{{ category }}">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <!-- Student Information -->
        <div class="student-info">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h2 style="margin: 0;">üë§ Student Information</h2>
                <div>
                    <button onclick="resetStudentProgress()" class="btn" style="background: #cc4400; margin-right: 10px;">üîÑ Reset All Progress</button>
                    <button onclick="resetGameModes()" class="btn" style="background: #cc4400;">üéÆ Reset Game Modes</button>
                </div>
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                <div>
                    <strong>Full Name:</strong> {{ student.full_name }}<br>
                    <strong>Student ID:</strong> {{ student.id }}<br>
                    <strong>Username:</strong> {{ student.username }}
                </div>
                <div>
                    <strong>Email:</strong> {{ student.email or 'Not provided' }}<br>
                    <strong>Status:</strong> {% if student.active %}Active{% else %}Inactive{% endif %}<br>
                    <strong>Created:</strong> {{ student.created_date[:10] if student.created_date else 'Unknown' }}
                </div>
                <div>
                    <strong>Last Login:</strong> {{ student.last_login[:19].replace('T', ' ') if student.last_login else 'Never' }}
                </div>
            </div>
        </div>

        <!-- Performance Statistics -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value">{{ progress.games_played }}</div>
                <div class="stat-label">Total Games</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ progress.best_score }}</div>
                <div class="stat-label">Best Score</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ progress.total_score }}</div>
                <div class="stat-label">Total Score</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ progress.stats.average_accuracy }}%</div>
                <div class="stat-label">Average Accuracy</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ progress.stats.total_correct }}</div>
                <div class="stat-label">Correct Answers</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ (progress.stats.total_time / 60) | round(1) }}</div>
                <div class="stat-label">Total Time (min)</div>
            </div>
        </div>

        <!-- Levels Completed -->
        {% if progress.levels_completed %}
        <div class="levels-completed">
            <h3 style="margin-top: 0;">üèÜ Completed Levels ({{ progress.levels_completed|length }})</h3>
            <div class="level-badges">
                {% for level in progress.levels_completed %}
                <div class="level-badge">Level {{ level }}</div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Game History -->
        {% if progress.game_history %}
        <div class="game-history">
            <h3 style="margin-top: 0;">üéÆ Recent Game History</h3>
            <div style="overflow-x: auto;">
                <table class="history-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Game Type</th>
                            <th>Level</th>
                            <th>Score</th>
                            <th>Correct/Total</th>
                            <th>Accuracy</th>
                            <th>Time</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for game in progress.game_history|reverse %}
                        <tr>
                            <td>{{ game.date[:19].replace('T', ' ') }}</td>
                            <td>{{ game.game_type.replace('_', ' ').title() }}</td>
                            <td>{% if game.level %}{{ game.level }}{% else %}-{% endif %}</td>
                            <td><strong>{{ game.score }}</strong></td>
                            <td>{{ game.correct_answers }}/{{ game.total_questions }}</td>
                            <td>
                                <span class="{% if game.accuracy >= 80 %}accuracy-good{% elif game.accuracy >= 60 %}accuracy-fair{% else %}accuracy-poor{% endif %}">
                                    {{ game.accuracy }}%
                                </span>
                            </td>
                            <td>{{ (game.time_taken / 60) | round(1) }}m</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        {% else %}
        <div class="game-history">
            <h3 style="margin-top: 0;">üéÆ Game History</h3>
            <p style="text-align: center; color: #333; font-style: italic;">
                No games played yet. Encourage the student to start playing!
            </p>
        </div>
        {% endif %}
    </div>

    <script>
        function resetStudentProgress() {
            const studentName = '{{ student.full_name }}';
            const studentId = '{{ student.id }}';
            
            const confirmMessage = `‚ö†Ô∏è Are you sure you want to RESET ALL PROGRESS for ${studentName}?\n\n` +
                                 `This will permanently delete:\n` +
                                 `‚Ä¢ All game history and scores\n` +
                                 `‚Ä¢ Level completion progress\n` +
                                 `‚Ä¢ Performance statistics\n` +
                                 `‚Ä¢ Achievement records\n\n` +
                                 `This action CANNOT be undone!\n\n` +
                                 `Type "RESET" to confirm:`;
            
            const confirmation = prompt(confirmMessage);
            if (confirmation === "RESET") {
                window.location.href = `/teacher/reset-student-progress/${studentId}`;
            }
        }
        
        function resetGameModes() {
            const studentName = '{{ student.full_name }}';
            const studentId = '{{ student.id }}';
            
            const confirmMessage = `‚ö†Ô∏è Reset game mode sessions for ${studentName}?\n\n` +
                                 `This will clear:\n` +
                                 `‚Ä¢ Any active Test Yourself sessions\n` +
                                 `‚Ä¢ Any active Endless Mode sessions\n` +
                                 `‚Ä¢ Current game state data\n\n` +
                                 `Their progress history will be preserved.\n\n` +
                                 `Continue?`;
            
            if (confirm(confirmMessage)) {
                window.location.href = `/teacher/reset-game-modes/${studentId}`;
            }
        }
    </script>
</body>
</html>