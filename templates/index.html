<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Battle: Dungeons of Knowledge - Home</title>
    <link href="https://fonts.googleapis.com/css2?family=MedievalSharp&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        /* Merge of home + index styles */
        body {
            font-family: 'Georgia', serif;
            /* Use the same gradient/color as the main stylesheet instead of an image */
            background: linear-gradient(135deg, #2e3d1f 0%, #1a2312 100%);
            color: #f8e5b3;
            text-align: center;
            margin: 0;
            padding: 0;
        }
        .overlay {
            /* overlay not needed when using a solid/gradient background */
            display: none;
        }
        .site-title {
            margin-top: 60px;
            font-size: 3em;
            color: #ffcc66;
            text-shadow: 2px 2px 10px #8b0000;
            font-family: 'MedievalSharp', cursive;
        }
        .tagline {
            font-family: 'MedievalSharp', cursive;
            font-size: 1.2em;
            color: #f5deb3;
            margin-top: 6px;
        }
        .teacher-login-bottom {
            text-align: center;
            margin: 30px auto 20px;
            padding: 15px;
        }
        .teacher-login-bottom .teacher-login-btn {
            background: #4b2e05;
            color: #f3eac2;
            padding: 12px 24px;
            border-radius: 8px;
            text-decoration: none;
            font-size: 1em;
            font-weight: bold;
            border: 2px solid #b8860b;
            transition: all 0.3s ease;
            display: inline-block;
        }
        .teacher-login-bottom .teacher-login-btn:hover {
            background: #2e3d1f;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }

        @media (max-width: 600px) {
            .site-title {
                font-size: 2.2em;
            }
            .teacher-login-bottom .teacher-login-btn {
                font-size: 0.9em;
                padding: 10px 20px;
            }

        }
        .scroll-box {
            background: rgba(40, 20, 10, 0.85);
            border: 3px solid #b8860b;
            border-radius: 15px;
            max-width: 1000px;
            margin: 30px auto;
            padding: 30px;
            box-shadow: 0 0 25px #000;
            display: flex;
            flex-direction: row;
            gap: 20px;
            align-items: center;
            
        }
        .intro {
            flex: 2;
            text-align: left;
            color: #f5deb3;
        }
        .controls {
            flex: 1;
            text-align: center;
        }
        .btn {
            display: inline-block;
            margin: 12px 10px;
            padding: 12px 28px;
            font-size: 1.15em;
            border-radius: 8px;
            border: 2px solid #b8860b;
            background: linear-gradient(145deg, #8b0000, #3b0000);
            color: #f8e5b3;
            text-decoration: none;
            font-weight: bold;
            box-shadow: 1px 1px 6px #0008;
            transition: transform 0.15s, box-shadow 0.15s;
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px #0008; }
        .small { font-size: 0.9em; padding: 10px 18px; }
        footer { margin-top: 40px; color: #d2b48c; }
        @media (max-width: 800px) {
            .scroll-box { flex-direction: column; padding: 20px; }
            .intro { text-align: center; }
        }

    </style>
</head>
<body>
    <div class="overlay"></div>
    <div class="site-title">‚öîÔ∏è Quiz Battle: Dungeons of Knowledge ‚öîÔ∏è</div>
    <div class="tagline">Fight enemies while learning Unix commands ‚Äî conquer the dungeon!</div>

    <div class="scroll-box">
        <div class="intro">
            <h2 style="font-size: 1.8em;">Brave adventurer, your quest awaits!</h2>
            <p style="font-size: 1.1em;">
                Test your wisdom in the mystical Quiz Battle. Each correct answer strikes down your foes ‚Äî
                but beware, for every mistake weakens your spirit! Conquer all 10 enemies and earn your title as the
                <strong>Ultimate Champion of the Realm</strong>.
            </p>
            <p style="margin-top:12px; color:#f0d9b5; font-size: 1.05em;">Quick tips: answer fast for bonus damage; use keywords when unsure; watch your health and the timer.</p>
            
            <!-- Student Login Section -->
            <div style="margin-top: 100px; display: flex; justify-content: flex-start;">
                <div style="padding: 15px; background: rgba(75, 46, 5, 0.3); border-radius: 8px; border: 1px solid #b8860b; width: 280px;">
                    <div style="color: #f0d9b5; margin-bottom: 15px; font-size: 0.9em; text-align: center;">üìö Student Login to Track Your Progress</div>
                    <div style="display: flex; justify-content: center;">
                        <a href="{{ url_for('student_login') }}" class="btn" style="background: #2d5016; min-width: 160px; text-align: center;">üéì Student Login</a>
                    </div>
                    <div style="margin-top: 10px; font-size: 0.8em; color: #d0d0d0; text-align: center;">Login to save your progress and track your learning journey!</div>
                </div>
            </div>
        </div>

        <div class="controls">
            <a href="{{ url_for('select_level') }}" class="btn">üéÆ Start Game</a>
            {% if settings and settings.test_yourself_enabled %}
            <a href="{{ url_for('test_yourself', new=1) }}" class="btn">üß™ Test Yourself</a>
            {% endif %}
            {% if settings and settings.endless_mode_enabled %}
            <a href="{{ url_for('endless') }}" class="btn">‚ôæÔ∏è Endless Mode</a>
            {% endif %}
            <a href="{{ url_for('howto') }}" class="btn small">üìú How to Play</a>
            
            <!-- Guest Leaderboard Section -->
            <div style="margin-top: 20px; display: flex; justify-content: center;">
                <div style="padding: 15px; background: rgba(139, 0, 0, 0.3); border-radius: 8px; border: 1px solid #8b0000; width: 280px;">
                    <div style="color: #f0d9b5; margin-bottom: 15px; font-size: 0.9em; text-align: center;">üèÜ Guest Player Rankings</div>
                    <div style="display: flex; justify-content: center; margin-bottom: 10px;">
                        <a href="{{ url_for('guest_leaderboard') }}" class="btn" style="background: #8b0000; min-width: 160px; text-align: center;">üèÜ View Leaderboard</a>
                    </div>
                    <div style="margin-top: 5px; font-size: 0.8em; color: #d0d0d0; text-align: center;">See how you stack up against other guest players!</div>
                </div>
            </div>
            
            <div style="margin-top:14px; font-size:0.9em; color:#e6d3b0; text-align: center;">Already have a level selected? Continue to play.</div>
        </div>
    </div>

    <!-- Teacher Login Section -->
    <div class="teacher-login-bottom">
        <a href="{{ url_for('teacher_login') }}" class="teacher-login-btn">üë®‚Äçüè´ Teacher Login</a>
    </div>

    <footer>
        <p>&copy; Quiz Battle ‚Äî Built for learning and fun</p>
    </footer>

    <script>
        // Login prompt functionality
        function checkLoginAndStartGame(gameMode) {
            // Check if user is logged in as student
            fetch('/check_student_session')
                .then(response => response.json())
                .then(data => {
                    if (data.logged_in) {
                        // Student is logged in, proceed to game
                        window.location.href = gameMode;
                    } else {
                        // Show login prompt
                        showLoginPrompt(gameMode);
                    }
                })
                .catch(error => {
                    console.error('Error checking login status:', error);
                    // On error, show login prompt to be safe
                    showLoginPrompt(gameMode);
                });
        }

        function showLoginPrompt(gameMode) {
            const modal = document.createElement('div');
            modal.className = 'login-modal';
            modal.innerHTML = `
                <div class="login-modal-content">
                    <h3>üéÆ Student Login Required</h3>
                    <p>Please log in to your student account to start playing and save your progress!</p>
                    <div class="login-modal-buttons">
                        <button onclick="window.location.href='/student/login'" class="login-btn">Student Login</button>
                        <button onclick="continueAsGuest('${gameMode}')" class="guest-btn">Play as Guest</button>
                        <button onclick="closeLoginModal()" class="close-btn">Cancel</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function continueAsGuest(gameMode) {
            closeLoginModal();
            
            // Check if guest already has a name stored in session
            fetch('/check_guest_name')
                .then(response => response.json())
                .then(data => {
                    if (data.has_name) {
                        // Name already exists, proceed directly to game
                        window.location.href = gameMode;
                    } else {
                        // No name stored, show name prompt
                        showGuestNamePrompt(gameMode);
                    }
                })
                .catch(error => {
                    console.error('Error checking guest name:', error);
                    // On error, show name prompt to be safe
                    showGuestNamePrompt(gameMode);
                });
        }

        function showGuestNamePrompt(gameMode) {
            const modal = document.createElement('div');
            modal.className = 'login-modal';
            modal.innerHTML = `
                <div class="login-modal-content">
                    <h3>üéØ Enter Your Name</h3>
                    <p>Please enter your name to appear on the guest leaderboard!</p>
                    <div class="name-input-section">
                        <input type="text" id="guestNameInput" placeholder="Enter your name..." maxlength="20" style="padding: 10px; font-size: 1.1em; border-radius: 6px; border: 2px solid #4b2e05; width: 250px; margin: 10px 0;">
                    </div>
                    <div class="login-modal-buttons">
                        <button onclick="submitGuestName('${gameMode}')" class="login-btn">Start Game</button>
                        <button onclick="skipNameAndPlay('${gameMode}')" class="guest-btn">Skip (Play as Anonymous)</button>
                        <button onclick="closeGuestNameModal()" class="close-btn">Cancel</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // Focus on input and handle Enter key
            const nameInput = document.getElementById('guestNameInput');
            nameInput.focus();
            nameInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    submitGuestName(gameMode);
                }
            });
        }

        function submitGuestName(gameMode) {
            const nameInput = document.getElementById('guestNameInput');
            const playerName = nameInput.value.trim();
            
            if (playerName && playerName.length > 0) {
                // Send name to server to store in session
                fetch('/set_name', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: 'player_name=' + encodeURIComponent(playerName)
                })
                .then(() => {
                    closeGuestNameModal();
                    window.location.href = gameMode;
                })
                .catch(error => {
                    console.error('Error setting name:', error);
                    // Continue anyway
                    closeGuestNameModal();
                    window.location.href = gameMode;
                });
            } else {
                // Highlight empty field
                nameInput.style.borderColor = '#ff4444';
                nameInput.placeholder = 'Please enter a name...';
                nameInput.focus();
            }
        }

        function skipNameAndPlay(gameMode) {
            // Set anonymous name and continue
            fetch('/set_name', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: 'player_name=Anonymous'
            })
            .then(() => {
                closeGuestNameModal();
                window.location.href = gameMode;
            })
            .catch(error => {
                console.error('Error setting anonymous name:', error);
                // Continue anyway
                closeGuestNameModal();
                window.location.href = gameMode;
            });
        }

        function closeGuestNameModal() {
            const modal = document.querySelector('.login-modal');
            if (modal) {
                modal.remove();
            }
        }

        function closeLoginModal() {
            const modal = document.querySelector('.login-modal');
            if (modal) {
                modal.remove();
            }
        }

        // Update game mode buttons to use the login check
        document.addEventListener('DOMContentLoaded', function() {
            // Adventure Mode
            const adventureBtn = document.querySelector('a[href="/select_level"]');
            if (adventureBtn) {
                adventureBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    checkLoginAndStartGame('/select_level');
                });
            }

            // Test Yourself
            const testBtn = document.querySelector('a[href*="test_yourself"]');
            if (testBtn) {
                testBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    checkLoginAndStartGame('/test_yourself');
                });
            }

            // Endless Mode
            const endlessBtn = document.querySelector('a[href="/endless"]');
            if (endlessBtn) {
                endlessBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    checkLoginAndStartGame('/endless');
                });
            }
        });
    </script>
</body>
</html>
