<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Metadata and linking the CSS file -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gamify RPG - Game</title>
    <link href="https://fonts.googleapis.com/css2?family=MedievalSharp&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        body { 
            font-family: 'MedievalSharp', cursive; 
            background: #2e3d1f; 
            color: #f3eac2; 
            margin: 0;
            padding: 20px;
        }
        .game-container { 
            max-width: 800px; 
            margin: 20px auto; 
            background: #f3eac2; 
            border: 6px solid #4b2e05; 
            border-radius: 24px; 
            box-shadow: 0 0 24px #0008; 
            padding: 32px 24px 24px 24px; 
            text-align: center; 
        }
        .game-title {
            color: #4b2e05; 
            font-size: 2.5em; 
            font-weight: bold; 
            background: #fffbe6; 
            border-radius: 16px; 
            padding: 18px 0 14px 0; 
            margin-bottom: 18px;
            letter-spacing: 2px;
        }
        .timer { 
            font-size: 1.3em; 
            color: #b22222; 
            margin-bottom: 12px; 
        }
        .questions-left { 
            font-size: 1.2em; 
            color: #4b2e05; 
            background: #ffeebc;
            border-radius: 10px;
            padding: 10px 0;
            margin-bottom: 18px;
        }
        .character-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            gap: 20px;
        }
        .character-info {
            flex: 1;
            text-align: center;
        }
        .character-avatar {
            width: 80px;
            height: 80px;
            border-radius: 12px;
            object-fit: contain;
            border: 3px solid #4b2e05;
            margin-bottom: 8px;
        }
        .character-avatar.placeholder {
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            background: #fffbe6;
            color: #4b2e05;
            border-radius: 12px;
            border: 3px solid #4b2e05;
        }
        .character-name {
            font-weight: bold;
            color: #4b2e05;
            margin-bottom: 5px;
        }
        .hp-bar {
            width: 100%;
            height: 20px;
            background: #ddd;
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid #4b2e05;
            margin-bottom: 5px;
        }
        .hp-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            transition: width 0.3s ease;
            text-align: center;
            line-height: 16px;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }
        .enemy-hp-fill {
            background: linear-gradient(90deg, #f44336, #ff9800);
        }
        .question {
            font-size: 1.4em; 
            margin: 24px 0; 
            color: #4b2e05; 
            background: #fffbe6; 
            border-radius: 12px; 
            padding: 18px 12px; 
            box-shadow: 0 2px 8px #0002; 
        }
        .btn { 
            font-family: 'MedievalSharp', cursive;
            background: #4b2e05;
            color: #f3eac2;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            margin-top: 10px;
        }
        .btn:hover {
            background: #6d4106;
        }
        input[type="text"] {
            font-family: 'MedievalSharp', cursive;
            padding: 12px;
            border: 2px solid #4b2e05;
            border-radius: 8px;
            font-size: 1em;
            width: 300px;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <!-- Main container for the game content -->
    <div class="game-container">
        <!-- Game Title -->
        <h1 class="game-title">‚öîÔ∏è Battle Arena</h1>
        
        <!-- Timer -->
        <div class="timer" id="timer">‚è±Ô∏è Time Left: {{ time_left }} seconds</div>
        
        <!-- Questions Progress -->
        <div class="questions-left">Question {{ q_number }} of {{ total }} | Level {{ level }}</div>
        
        <!-- Character Stats Section -->
        <div class="character-stats">
            <!-- Player Info -->
            <div class="character-info">
                {% if session.get('character') %}
                <img class="character-avatar" src="{{ url_for('static', filename='characters/character' ~ session.get('character') ~ '.png') }}" alt="Player avatar">
                {% else %}
                <div class="character-avatar placeholder">üßë</div>
                {% endif %}
                <div class="character-name">Player</div>
                <div class="hp-bar">
                    <div class="hp-fill" style="width: {{ player_hp }}%;">{{ player_hp }}/100 HP</div>
                </div>
                <div style="color: #4b2e05; font-weight: bold;">‚≠ê Score: {{ score }}</div>
            </div>
            
            <!-- Enemy Info -->
            <div class="character-info">
                {% if enemy_image %}
                    <img class="character-avatar" src="{{ enemy_image }}" alt="Enemy avatar">
                {% else %}
                    <div class="character-avatar placeholder">{{ enemy.avatar }}</div>
                {% endif %}
                <div class="character-name">{{ enemy.name }}</div>
                <div class="hp-bar">
                    <div class="hp-fill enemy-hp-fill" style="width: {{ enemy_hp }}%;">{{ enemy_hp }}/100 HP</div>
                </div>
                <div style="color: #4b2e05; font-style: italic;">"{{ enemy.taunt }}"</div>
            </div>
        </div>

        <!-- Question Section -->
        <div class="question">{{ question['q'] }}</div>
        
        <!-- Answer Form -->
        <form method="POST">
            <input type="text" name="answer" placeholder="Type your answer..." required>
            <button type="submit" class="btn">Attack!</button>
        </form>
    </div>

    <script>
        // Initialize the remaining time from the backend
        let timeLeft = {{ time_left }};
        const timerElement = document.getElementById("timer");

        // Countdown logic to update the timer every second
        const countdown = setInterval(() => {
            if (timeLeft > 0) {
                // Decrease the time left and update the timer text
                timeLeft--;
                timerElement.innerText = "‚è±Ô∏è Time Left: " + timeLeft + " seconds";
            } else {
                // Stop the countdown when time reaches 0
                clearInterval(countdown);
                timerElement.innerText = "‚è≥ Time's up!";
            }
        }, 1000); // Run the function every 1000ms (1 second)
    </script>
</body>
</html>
